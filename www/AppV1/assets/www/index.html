
<!DOCTYPE html>
<html>

<head>

</head>

        <script type="text/javascript" charset="utf-8" src="cordova-2.7.0.js"></script>
	    <script type="text/javascript" charset="utf-8" src="jpgraph.js" ></script>
	    <script type="text/javascript" src="user.js"></script>
	    <script type="text/javascript" src="checkDataReady.js"></script>
		<script type="text/javascript" src="GeoLocationLogger.js"></script>
		<script type="text/javascript" src="phoneStateListener.js"></script>
		<script type="text/javascript" src="HttpReq.js"></script>
		<script type="text/javascript" src="AccelerationLogger.js"></script>
		<script type="text/javascript" src="AppDataLogger.js"></script>
        <script type="text/javascript" charset="utf-8" src="datePickerPlugin.js"></script>
        <script type="text/javascript" src="dateAndTime.js"></script>
        <script type="text/javascript" src="includes.js"></script>
        <script type="text/javascript" charset="utf-8">


    document.addEventListener("deviceready", onDeviceReady, false);


    function onDeviceReady()
    {
		// some init code here

		// some background setIntervals -
		// For eg: local DB to remote DB push,
		// clear old data from local DB
		document.addEventListener("pause", onPause, false);

    }

    function onPause()
    {
       PhoneCallsLogger();
       //alert("AFTER PHONE CALLS");
    }

    function PhoneCallsLogger()
	{
	   //alert("PHONE CALLS LOGGER");
		phoneStateListener.start(function (state,number){
          //alert("STATE"+state);
          //alert("NUMBER"+number);
          type = 2;
          //checkDataReady();
          phonenumber = number;
          });

       ringStateListener.start(function (state,number){
        type = 4;
        //checkDataReady();
          //alert("STATE"+state);
          //alert("NUMBER"+number);
          phonenumber = number;
          });
	}


	function StartTracking()
	{
		// start logging the data
		// set repeat intervals for each of the loggers
		alert('Starting to Track Usage Data');
		CreateTables();
		getUID();

		  LocnID = setInterval(GeolocationLogger, frequency);
		  AcclID = setInterval(AccelerationLogger, frequency);
		  AppListID = setInterval(AppDataLogger, frequency);
	    //phoneCallsID = setInterval(PhoneCallsLogger, 10000);

		 readyCheckID = setInterval(checkData, frequency);

	}

    function StopTracking()
	{
		// stop the loggers by clearing the intervals for all IDs
		alert('Stopping Tracking Usage Data');

		if(LocnID != null)
			clearInterval(LocnID);
		if(AcclID != null)
			clearInterval(AcclID);
		if(AppListID != null)
			clearInterval(AppListID);
		if(readyCheckID != null)
			clearInterval(readyCheckID);

		currLat = null;
		currLon = null;
		ax = null;
		ay = null;
		az = null;
		aTime = null;
		lTime = null;
		AppData = null;

		/*if(DBpushID != null)
			clearInterval(DBpushID);*/ // for now pushing every log to remote server's DB
	}

    function checkData()
    {
       checkDataReady(0);
    }

	function SMSLogger()
	{
		// this uses broadcast receiver notification on ringer settings changed
	}

	function ShowAppUsage_OnMap()
	{
	    var fromDate = document.getElementById("FromDateMap").value;
	    var fromTime = document.getElementById("FromTimeMap").value;
	    var toDate = document.getElementById("ToDateMap").value;
	    var toTime = document.getElementById("ToTimeMap").value;

	    if(fromTime!='' && fromDate=='')
	    {
	      alert("Date must be entered with Time");
	      document.getElementById("FromDateMap").focus();
	    }
	    if(toTime!='' && toDate=='')
	    {
	      alert("Date must be entered with Time");
	      document.getElementById("ToDateMap").focus();
	    }

	    localStorage.setItem('fromDate',fromDate);
	    localStorage.setItem('fromTime',fromTime);
	    localStorage.setItem('toDate',toDate);
	    localStorage.setItem('toTime',toTime);

	    localStorage.setItem('UID',uid);

	    window.location = "displayLocation.html";
	}

	function ShowAppUsageGraph()
	{
      window.location = "AppUsageGraph.html";
    }

	function ShowAccelerationGraph()
	{
	  window.location = "AccelerationGraph.html";
	}


	</script>
	<body>
	<table>
		 <tr>
		    <td><button type="button" onclick="StartTracking()">Start</button></td>

			<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
			<td><button type="button" onclick="StopTracking()">Stop</button></td>
		 </tr>
		 <tr><td>&nbsp;</td></tr>
    </table>

		  <table>
			<tr>
			  <td>From:</td>
			  <td> <input type="text" id="FromDateAcc" class="nativedatepicker" onfocus="getDate(this)"></td>
			  <td> <input type="text" id="FromTimeAcc" class="nativetimepicker" onfocus="getTime(this)"></td>
			</tr>
			<tr>
			  <td>To:</td>
			  <td> <input type="text" id="ToDateAcc" class="nativedatepicker" onfocus="getDate(this)"></td>
			  <td> <input type="text" id="ToTimeAcc" class="nativetimepicker" onfocus="getTime(this)"></td>
			</tr>
			<tr>
			<td>
			  &nbsp;
			</td>
			<td>
			   <input type="button" onclick="ShowAccelerationGraph()" value="Show Acceleration" />
			</td>
			</tr>



			<tr>
			  <td>From:</td>
			  <td> <input type="text" name="FromDateApp" class="nativedatepicker" onfocus="getDate(this)"></td>
			  <td> <input type="text" name="FromTimeApp" class="nativetimepicker" onfocus="getTime(this)"></td>
			</tr>
			<tr>
			  <td>To:</td>
			  <td> <input type="text" name="ToDateApp" class="nativedatepicker" onfocus="getDate(this)"></td>
			  <td> <input type="text" name="ToTimeApp" class="nativetimepicker" onfocus="getTime(this)"></td>
			</tr>
			<tr>
			<td>
			  &nbsp;
			</td>
			<td>
			   <button name="buttonClick" onclick="ShowAppUsageGraph()">Show App Usage</button>
			</td>
			</tr>



			<tr>
			  <td>From:</td>
			  <td> <input type="text" id="FromDateMap" class="nativedatepicker" onfocus="getDate(this)"></td>
			  <td> <input type="text" id="FromTimeMap" class="nativetimepicker" onfocus="getTime(this)"></td>
			</tr>
			<tr>
			  <td>To:</td>
			  <td> <input type="text" id="ToDateMap" class="nativedatepicker" onfocus="getDate(this)"></td>
			  <td> <input type="text" id="ToTimeMap" class="nativetimepicker" onfocus="getTime(this)"></td>
			</tr>
			<tr>
			<td>&nbsp;</td>
			<td>
			   <button name="buttonClick" onclick="ShowAppUsage_OnMap()">Show Map</button>
			</td>
			</tr>

		 </table>
	</body>
</html>